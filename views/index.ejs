<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>M.W.D</title>
    <link type="text/css" rel="stylesheet" href="/static/css/shared.css">
    <link type="text/css" rel="stylesheet" href="/static/css/index.css">
</head>
<body>
    <div class="topnav">
        <div class="barner">
            <h3 class="title">M.W.D</h3>
        </div>
        <div class="actions">
            <button class="small">Theme</button>
        </div>
    </div>
    <div class="full landing">
        <div class="container">
            <header>
                <h3 class="big_text"><%= players%></h3>
                <h2>members are online</h2>
            </header>
            <button onclick="join()" class="button big">Join</button>
        </div>
    </div>

    <div class="player_form" id="player_form">
        <label for="playername">Your player name</label>
        <input id="playername" type="text" name="playername" class="input" placeholder="Player name..."/>
        <button id="button" class="button big" disabled>Play</button>
    </div>
    <div class="cover" onclick="clear()"></div>
    <script >
        //modules
        

        var form=document.getElementById("player_form");
        var cover=document.querySelector('.cover')
        var playernameInput=document.getElementById('playername')
        var btn=document.getElementById("button")

        var username=""
        
        playernameInput.addEventListener('keyup',(e)=>{
            
            var username=playernameInput.value
            if(username.length>0){
                btn.disabled=false
            }else{
                btn.disabled=true
            }
        })

        btn.addEventListener('click',(e)=>{
            var f_name=playernameInput.value
            if(f_name.length>0){
                //store the username in the IndexDb
                console.log(f_name)
                post({"playername":f_name},(data)=>{
                    if(data.state=="success"){
                        
                        window.location.replace("http://localhost:4000/players")
                    }
                })
            }else{
                //emitt error
                console.log("Fill the username")
            }
        })
        
        function post(dataToSend,callback){
            fetch("http://localhost:4000/",{
                method:'POST',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({"playername":dataToSend.playername})
            })
            .then(response=>response.json())
            .then(data=>callback(data))
            .catch(error=>{
                console.error("Error: "+error)
                console.error("Could not send post request\n"+this.url+"\n"+dataToSend.playername)
            })
        }


        function join(){
            cover.style.display="block";
            form.style.display="block";
        }
        function clear(){
            cover.style.display="none";
            form.style.display="none";
        }
    </script>
</body>
</html>